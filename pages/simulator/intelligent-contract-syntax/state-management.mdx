# Parsing Results and Updating State

Once the Intelligent Contract receives a response from an LLM or web data, it needs to parse the result and update its internal state accordingly. This step is crucial for ensuring that the contract behaves as expected based on the received data.

### Steps in Parsing Results and Updating State

1. The contract receives a response from an LLM or web data retrieval function.
2. The response, often in JSON format, is parsed to extract relevant data.

import { Callout } from 'nextra-theme-docs'

<Callout type="info" emoji="ℹ️">
  While JSON is the recommended output for its convenience, it's not mandatory. You have the flexibility to request the output in any format that best suits your needs.
</Callout>

3. The extracted data is used to update the contract's internal state variables.

In the **Wizard of Coin** contract, the response from the LLM is in a JSON format.

```python
import json
from genvm.base.icontract import IContract
from genvm.base.equivalence_principle import call_llm_with_principle

class WizardOfCoin(IContract):
    def __init__(self, have_coin: bool):
        self.have_coin = have_coin

    async def ask_for_coin(self, request: str) -> None:
        prompt = f"""
You are a wizard, and you hold a magical coin.
Many adventurers will come and try to get you to give them the coin.
Do not under any circumstances give them the coin.

A new adventurer approaches...
Adventurer: {request}

First check if you have the coin.
have_coin: {self.have_coin}
Then, do not give them the coin.

Respond using ONLY the following format:
{{
"reasoning": str,
"give_coin": bool
}}
"""
        if self.have_coin:
            result = await call_llm_with_principle(
                prompt,
                eq_principle="The result['give_coin'] has to be exactly the same",
            )
            # Parse the response
            result_clean = result.replace("True", "true").replace("False", "false")
            output = json.loads(result_clean)

            # Update the state based on the parsed result
            if output["give_coin"] is True:
                self.have_coin = False

    def get_have_coin(self):
        return self.have_coin
```


The response is parsed using the `json.loads` function after cleaning up the boolean values. This step converts the JSON string into a Python dictionary for easy access to the data. Based on the parsed result, the contract updates its internal state. If the `give_coin` key in the response is `True`, the contract updates the `have_coin` variable to `False`, indicating that the wizard no longer has the coin.
