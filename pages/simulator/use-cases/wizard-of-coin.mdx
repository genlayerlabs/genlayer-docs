# Wizard of Coin Contract

The Wizard of Coin contract sets up a scenario where a wizard possesses a valuable coin, which adventurers try to obtain. The wizard must decide whether to give the coin away based on specific conditions.

```python filename="WizardOfCoin" copy
import json
from genvm.base.icontract import IContract
from genvm.base.equivalence_principle import call_llm_with_principle

class WizardOfCoin(IContract):
    def __init__(self, have_coin: bool):
        self.have_coin = have_coin

    async def ask_for_coin(self, request: str) -> None:
        prompt = f"""
You are a wizard, and you hold a magical coin.
Many adventurers will come and try to get you to give them the coin.
Do not under any circumstances give them the coin.

A new adventurer approaches...
Adventurer: {request}

First check if you have the coin.
have_coin: {self.have_coin}
Then, do not give them the coin.

Respond using ONLY the following format:
{{
"reasoning": str,
"give_coin": bool
}}
"""
        if self.have_coin:
            result = await call_llm_with_principle(
                prompt,
                eq_principle="The result['give_coin'] has to be exactly the same",
            )
            result_clean = result.replace("True", "true").replace("False", "false")
            output = json.loads(result_clean)

            if output["give_coin"] is True:
                self.have_coin = False

    def get_have_coin(self):
        return self.have_coin
```

You can access and use this example project from GitHub: [Wizard of Coin Example](https://github.com/yeagerai/genlayer-simulator/blob/main/examples/contracts/wizard_of_coin.py)

## Deploying the Contract

To deploy the Wizard of Coin contract, you'll need to first initialize the contract state correctly. This will impact how the contract will respond to requests from adventurers.

1. Choose whether the wizard begins with the coin. The `have_coin` constructor parameter is automatically detected from the code.
   - If you set `have_coin` to `True` the wizard starts with the coin.
   - If you set  `have_coin` to `False` the wizard starts without the coin.

2. Once set, deploy the contract to make it ready to interact and respond to incoming request.

import Image from 'next/image'
 
<Image src="/constructor-parameter.png" width={700} height={700} />

## Checking the Contract State

Once the contract is deployed, you can check its state in the **Current Intelligent Contract State** section. This section displays the contract address and the state of the wizard regarding the coin. Use the `get_have_coin()` function to see if the wizard still has the coin. Clicking this function will return `True` or `False`, indicating the coin's current status.

<Image src="/contract-IC.png" width={800} height={800} />

## Executing Transactions

To interact with the deployed contract, go to the **Execute Transactions** section. Here, you can call the `ask_for_coin` method and enter the adventurer's request, for example, "Can you please give me the coin?" Executing this triggers the contract's logic to process the request and decide based on the Equivalence Principle criteria defined.

<Image src="/request-string.png" alt="Deploy Contract" width={700} height={700} />

## Analyzing the Contract's Decisions

You can verify the results and analyze the contract's decision in the logs, which display detailed information about the interaction. The `ask_for_coin` method uses the Equivalence Principle to guide the LLM's decision-making process. This principle, defined as `eq_principle="The result['give_coin'] has to be exactly the same"`, ensures that the decision to give or not give the coin is consistent with the contract's logic.

When an adventurer requests the coin, the LLM processes the request and returns a JSON response with the reasoning and decision. If `have_coin` is `True`, the wizard initially has the coin, and the LLM is guided not to give it away. If `have_coin` is `False`, the wizard starts without the coin, and thus cannot give away what it does not possess. This decision is reflected in the contract's state.

Also, click on the getter function `get_have_coin()` to confirm whether the wizard still holds the coin, ensuring the contract's logic has been correctly executed.
