import { Callout } from "nextra-theme-docs";

# Validator upgrade guide

<Callout type="info" emoji="ðŸ’¡">
  For non-breaking changes, you can minimize the downtime by keeping your existing validator node running while
  you download and configure the new version according to the steps below. Once
  the upgrade is fully configured and ready to run, stop the old node and
  start the new one. 

  A fully Zero-downtime upgrade procedure is coming in a future update. 
</Callout>

## General Procedure

1. **Download the new package and extract into a fresh folder** - Always use a clean directory for the new version.
2. **Override with your custom config** - Configure the files in the new installation as you did when [setting up your node](/validators/setup-guide). Example: `.env` and `config.yaml`. You can refer to your previous settings. Avoid directly copying these files, as new versions may include updated default configurations.
3. **Copy the contents of your old data folder** - The `data/` folder is the stateful directory used by the node, containing the database and keystore. This step is not needed if your data folder is located outside of the project directory.

## v0.3.x â†’ v0.4 (Breaking Change)

`v0.4` switches to a new consensus deployment with staking. For this reason, the validator must be set up from scratch without reusing the old database stored at `data/node/genlayer.db`.
You do not need to keep your existing validator node running while you download and configure the new version.

This release involves a change from a single validator address to owner/operator separation. You will need to follow the [setup guide](/validators/setup-guide) to create your new Validator Wallet.

<Callout type="warning" emoji="âš ï¸">
  **Recommended: Keep your current validator key as the operator key**

  To maintain continuity, retain your current keystore and use your existing validator address as the operator address when following the setup guide. You can find your current validator address in `configs/node/wallet.yaml`.
</Callout>

- Stop the node if it is running.
- Note your current validator address from `configs/node/wallet.yaml` - you'll use this as your operator address.
- Back up the `configs/node/config.yaml` file so that you can refer to any values you have set in the previous version.
- Back up the `data/node/keystore` folder so that you can maintain your previous operator key.
- Download the packaged binary.
- Install the new version.
- Remove the storage folder `data/node/genlayer.db`.
- Check that configuration is correct by running `genlayernode doctor` command.
- Start the node.

Assuming already have the new tarball downloaded and extracted, copy your old keystore files to the new installation:

```shell
mkdir -p <path-to-new-installation>/data/node/keystore/
cp <path-to-old-installation>/data/node/keystore/* <path-to-new-installation>/data/node/keystore/
```
